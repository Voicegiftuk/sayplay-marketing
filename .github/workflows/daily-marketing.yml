name: Enterprise AI Marketing System

on:
  schedule:
    # Run daily at 9:00 UTC (10:00 UK time)
    - cron: '0 9 * * *'
  
  # Allow manual trigger
  workflow_dispatch:

jobs:
  run-marketing-campaign:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install FREE dependencies
        run: |
          pip install --break-system-packages -r requirements.txt
          echo "âœ… All FREE dependencies installed"
      
      - name: Run Enterprise Marketing System
        env:
          # AI & Content Generation (FREE!)
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          
          # Publishing Platforms
          SHOPIFY_SHOP: ${{ secrets.SHOPIFY_SHOP }}
          SHOPIFY_ACCESS_TOKEN: ${{ secrets.SHOPIFY_ACCESS_TOKEN }}
          FACEBOOK_PAGE_TOKEN: ${{ secrets.FACEBOOK_PAGE_TOKEN }}
          INSTAGRAM_BUSINESS_ACCOUNT_ID: ${{ secrets.INSTAGRAM_BUSINESS_ACCOUNT_ID }}
          
          # Optional (can be empty)
          TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
          TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
          TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
        run: |
          python enterprise_marketing_system.py
      
      - name: Commit generated files
        run: |
          git config --global user.name 'SayPlay Marketing Bot'
          git config --global user.email 'bot@sayplay.co.uk'
          git add content_history.json daily_research.json generated_blog.json || true
          git commit -m "ðŸ¤– Daily marketing campaign [$(date +'%Y-%m-%d')]" || echo "No changes to commit"
          git push || echo "Push failed or no changes"
      
      - name: Upload artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: marketing-campaign-logs
          path: |
            content_history.json
            daily_research.json
            generated_blog.json
          retention-days: 30
